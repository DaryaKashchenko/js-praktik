name: Tests

on: [push]

jobs:
  test:
   runs-on: ubuntu-latest

   steps:
     - uses: actions/checkout@v2
     - uses: actions/setup-node@v2
       with:
         node-version: 16
         cache: npm

     - name: Install modules
       run: npm install

     - name: Add ci
       run: npm ci

     - name: Get coverage
       continue-on-error: true
       run: npm run coverage

     - name: Use the Upload Artifact Github Action
       uses: actions/upload-artifact@v3
       with:
         name: report
         if-no-files-found: error
         path: test-report/index.html

     - name: Publication coverage report
       uses: actions/upload-artifact@v3
       with:
         name: coverage
         if-no-files-found: error
         path: coverage

     - name: Send report to telegram
       run: "curl -X POST https://api.telegram.org/bot${{secrets.BOT_TOKEN}}/sendMessage -H \'Content-Type: application/json\' -d '{\"chat_id\": \"{{secrets.$CHAT_ID}}\", \"text\": \"Hello\"}'"

